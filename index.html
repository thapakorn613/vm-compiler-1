<html>
    <head>
    <title>art ronin </title>
    </head>
<body>
    <script>
        // [1, 5, 3, 2, 12, 4, 9, 0] ->   5 time
        // [12, 0] -> Only Beep not repeat
        // const text = "1, 5, 3, 2, 12, 4, 9, 0"
        // const text = "1, 10, 16, 0"
        const text = "1, 1, 90, 49, 0"
        // const text = "49, 1, 15, 90, 0"
        // const text = "12, 0"
        var gblBuffer = [];
        var gblQueue = [];
        var lenghtOfBuffer = 0;
        var words = text.split(', ');
        
        for(var i=0;i<words.length;i++){
            var tempToInt = parseInt(words[i], 10);
            gblQueue.push(tempToInt);
        }

        
        var loop = gblQueue.shift();
        var imm;
        var localBuffer = [];
        var cmdOpcode;
        // Stack
        for(var i=0;i<gblQueue.length+1;i++){
            if (loop == 1){
                imm = gblQueue.shift();
                var cmdOpcode = gblQueue.shift();
                if (cmdOpcode == 3){ //  start of list
                    loop = gblQueue.shift();
                    while(loop != 4){
                        localBuffer.push(loop);
                        loop = gblQueue.shift();
                    }
                    cmdOpcode = gblQueue.shift();
                }
                cmdProcess(cmdOpcode);
                loop = gblQueue.shift();
            }else {
                cmdProcess(loop);
                loop = gblQueue.shift();
            }
            
            if(loop == 0){
                console.log("end of loo[] ");
                break;
            }
        }
        

        function cmdProcess(_cmdOpcode){
            switch (_cmdOpcode) {
                case 9:
                    Repeat(localBuffer,imm);
                    break;
                case 12:
                    var cmdstr = "beep";
                    sendCmd(cmdstr);
                    break;
                case 16:
                    cmdWait(imm);
                    break;
                case 49:
                    var cmdstr = "motorOn";
                    sendCmd(cmdstr);
                    break;
                case 90:
                    selectMotor(imm);
                    break;
                case 99:
                    showNumber(localBuffer,imm);
                    break;
                default:
                    console.log("none jahh ");
                    break;
            }
        }

        function showNumber(){
            console.log("none jahh ");
        }

        function selectMotor(_imm){
            console.log("select motor ",_imm);

        }
        function chooseCmd(opcode){
            var str="";
            switch(opcode){
                case 12:
                    str = "beep";
                    break;
                case 0:
                    str = "Looking";
                    break;
                default:
                    str = "none";
            }
            return str;
        }

        function Repeat(Queue,Imm){
            var opcode;
            var sendText;
            var typeImm = Queue.shift();
            if(typeImm == 2){
                opcode = Queue.pop();
                sendText = chooseCmd(opcode);
            }
            for(var i=0;i<Imm;i++){
                console.log(sendText);
                // send to MQTT at here
            }
        }

        function cmdWait(Imm){
            console.log("wait ",Imm);
        }

        function sendCmd(str){
            console.log(str);
        }

        
        
        // var count = 0;
        // if (words[count++] == "1"){
        //     console.log("word[",count,"] : ",words);
        //     var localBuffer =[];
        //     var begin;
        //     var immBuffer = parseInt(words[count++], 10);
        //     console.log("immBuffer : ",immBuffer);
        //     console.log("word[",count,"] : ",words);
        //     if (parseInt(words[count++], 10) == 3){ //  start of list
        //         var temp1 = parseInt(words[count++], 10);
        //         while(temp1 != 4){

        //             // var tempp = parseInt(words[count], 10);
        //             localBuffer.push(tempp);
        //             temp1 = parseInt(words[count++], 10);
        //             console.log("temp[",count,"] : ",temp1);    
        //         }
        //         console.log("word[",count,"] : ",words);
        //         console.log("localBuffer[",localBuffer);

        //     }
        //     if (parseInt(words[5], 10) == 9){ // start to repeat
        //         for(var i=0;i<tempLengh;i++){
        //             var temp = parseInt(words[4], 10);
        //             gblBuffer.push(temp);
        //         }
        //         console.log("gblBuffer : ",gblBuffer);
        //     }
        // }

        


       
        // const myFunction =(name)=> "huuttt "+name;
        // console.log(myFunction('gggg2'));

        // const myArray = ['thapakorn','peryporn','art',613];
        // let Arr1 = myArray.map(item => item);
        // console.log(Arr1);


    </script>

</body>

</html>